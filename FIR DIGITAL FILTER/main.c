// Lab 5 TU ID FIR Digital Filter// Benjamin Blouin   SP19// Dr. Silage ECE3622#include "DA2Pmod.h"#include "xparameters.h"#include "xil_io.h"#include <stdio.h>#include <math.h>#include <stdint.h>#include <limits.h>//DAC2Pmod from Address Editor in Vivado#define DA2acq  0x43C00000   //DA2 acquisition    - output#define DA2dav	0x43C00004	 //DA2 data available - input#define DA2dat1	0x43C00008	 //DA2 channel 1 data - output#define DA2dat2 0x43C0000C	 //DA2 channel 2 data - output#define N_FIR 5//FIR Filter Equation//y(m) = b0 x(m) + b1 x(m-1) + b2 x(m-2) + b3 x(m-3) + b4 x(m-4)static int LUTSIZE = 4095;static inline void SineLUT(int16_t  SINLUT[LUTSIZE]);static inline void FIR_Filter(int16_t SINLUT[LUTSIZE], int16_t FIRaccum[LUTSIZE],int16_t STEPSIZE);int main(void){	static int16_t STEPSIZE = 3; //Can change step size between FIR samples of Base Sine Wave    int16_t  SINLUT[LUTSIZE]; //DAC SINE LUT ARRAY DEFINITION    int16_t  FIRaccum[LUTSIZE]; //DAC SINE FIR LUT accumulator    SineLUT(SINLUT);	//FILL DAC SINE LUT    FIR_Filter(SINLUT, FIRaccum, STEPSIZE);    int dacdata=0;	//LUT index    int dacdav;		//DAC data available    int dacacq=0;	//DAC acquire    Xil_Out32(DA2acq,0);    while(1)    {        if(dacdata>=LUTSIZE)            dacdata=0;        dacdav=Xil_In32(DA2dav);        if(dacdav==0 && dacacq==0)			//DAC not in use?        {            Xil_Out32(DA2dat1, SINLUT[dacdata]);	//output DAC data            Xil_Out32(DA2dat2, FIRaccum[dacdata]);	//output DAC data            Xil_Out32(DA2acq,1);			//DAC acquire            dacacq=1;        }        if(dacdav==1 && dacacq==1)			//DAC data available        {            Xil_Out32(DA2acq,0);			//stop DAC acquire            dacacq=0;            dacdata = dacdata + STEPSIZE;			//increment DAC data        }    }}void SineLUT(int16_t  SINLUT[LUTSIZE]) {	for (int i = 0; i <= 4096; i++)    {        SINLUT[i] = (int16_t) 2046.9*sinf(2.0f * M_PI * ((float) i / LUTSIZE))+2049.9;    }}void FIR_Filter(int16_t  SINLUT[LUTSIZE], int16_t  FIRaccum[LUTSIZE], int16_t STEPSIZE){	//first four samples are special	//FIR Filter Equation	//y(m) = b0 x(m) + b1 x(m-1) + b2 x(m-2) + b3 x(m-3) + b4 x(m-4)	FIRaccum[0]=SINLUT[0];	FIRaccum[1]=SINLUT[1] + 3 * SINLUT[0];	FIRaccum[2]=SINLUT[2] + 3 * SINLUT[1] + 3 * SINLUT[0];	FIRaccum[3]=SINLUT[3] + 3 * SINLUT[2] + 3 * SINLUT[1] + 4 * SINLUT[0];	for(int i = 4; i<=4095;){		FIRaccum[i] = 0.0831*(SINLUT[i] + 3*SINLUT[i-1] + 3*SINLUT[i-2] + SINLUT[i-3] + 4*SINLUT[i-4]);		i+=STEPSIZE;	}}